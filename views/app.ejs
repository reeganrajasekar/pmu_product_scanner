<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="manifest" href="/manifest.json">
    <title>PMU</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="apple-touch-icon" href="/assets/logo.png">
    <link rel="manifest" href="/manifest.json" />
  	<link rel="shortcut icon" href="/assets/logo.png" >
    <script src="https://unpkg.com/html5-qrcode"></script>
    <meta name="theme-color" content="#000">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  	<style>
      body,html{
        width:100%;
        height:100%;
        margin:0px;
        background-color:#000;
        color:#fff;
        text-align:left !important;
        transition: display 2s linear !important;
        
      }
      #html5-qrcode-anchor-scan-type-change{
        display:none !important;
      }
      #html5-qrcode-button-camera-stop {
        width:70%;
        height:50px;
        background:red;
        color:#fff;
        margin:20px auto;
        border:none;
        border-radius:8px;
        font-size:20px;
      }
      #html5-qrcode-button-camera-start{
        width:70%;
        height:50px;
        background:green;
        color:#fff;
        margin:20px auto;
        border:none;
        border-radius:8px;
        font-size:20px;
      }
      #html5-qrcode-button-camera-permission{
        width:fit-content;
        height:50px;
        background:red;
        color:#fff;
        position:fixed;
        left:0;
        top:50%;
        right:0;
        bottom:50%;
        margin:20px auto;
        border:none;
        padding:15px;
        border-radius:8px;
        font-weight:900;
        font-size:20px;
      }
      #qr-reader{
        border:none !important;
        display:flex;
        flex-direction:column;
        justify-content:space-around;
        align-items:center;
      }
      img{display:none}
      select{
        display:block;
        width:80%;
        height:40px;
        background:#fff;
        color:#000;
        margin:auto;
        padding:5px;
        margin-top:10px;
        border:none;
        border-radius:8px;
      }
      .alert{
        width:90%;
        position:fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background:#fff;
        z-index:1000;
        padding:30px 0px 30px 0px;
        border:2px solid #444;
        border-radius:10px;
        color:green;
        font-weight:900;
        font-size:20px;
        text-align:center;
        display:none;
      }
      #pro{
        width:100%;
        background:#f9f9f9;
        z-index:900;
        position:absolute;
        top:0;
        color:#222;
        font-weight:900;
        font-size:20px;
        text-align:center;
      }
    </style>
</head>
<body>
    <div id="qr-reader" style="width:100%;height:100%"></div>
    <div class="alert" id="alert">
      <p id='result'>Product Verified Successfully !</p>
      <button onclick="document.getElementById('alert').style.display='none';document.getElementById('qr-reader').style.opacity='1.0';" style="height:50px;width:80%;background:green;color:#fff;font-size:20px;border:none;border-radius:10px">Scan another Product</button>
    </div>
  <div id="pro">
    <div style="height:60px"></div>
    <hr>
    <h4 style="text-align:left;padding-left:10px;color:#222">Select Product :</h4>
    <span style="text-align:left;padding-left:10px;color:#222">Cool Drinks</span>
    <div style="container">
      <div class="row p-3">
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/bovonto.png">
        </div>
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/coca.png">
        </div>
      </div>
      <span style="text-align:left;padding-left:10px;color:#222">FMCG</span>
      <div class="row p-3">
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/gw.png">
        </div>
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/no.png">
        </div>
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/hat.png">
        </div>
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/bingo.jpeg">
        </div>
      </div>
      <span style="text-align:left;padding-left:10px;color:#222">Perfumes</span>
      <div class="row p-3">
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/fog.jpeg">
        </div>
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/pa.png">
        </div>
      </div>
      <span style="text-align:left;padding-left:10px;color:#222">Napkin</span>
      <div class="row p-3">
        <div class="col-6">
          <img  onclick="document.getElementById('pro').style.display='none'" style="display:block;width:100%;height:100px;margin-bottom:20px;border:1px solid #f0f0f0;box-shadow:1px 3px 4px #bbb;border-radius:10px;font-weight:900;font-size:22px;color:#fff" src="/img/pad.png">
        </div>
      </div>
    </div>

  </div>
  <div style="top:0;bottom:0;left:0;right:0;margin:0px;background-color: #F5DBCC;height:100%;width:100%;z-index:1000;position: fixed;" id="load">
      <div id="android" style="display:none;margin:5%;background-color:#fff;position:fixed;bottom:0;left:0;right:0;border-radius: 20px;padding:10px">
        <h4 style="text-align: center;color:#042744;font-size: 22px;padding-top: 10px;font-weight: 900;"><b>Install PMU Product Scanner</b></h4>
        <hr>
        <button onclick="handleInstallClick()" style="color:#fff;background-color: #F67327;width:100%;height:60px;border:none;border-radius: 15px;font-size: 26px;">Install</button>
      </div>

      <div id="ios" style="display:none;margin:5%;background-color:#fff;position:fixed;bottom:0;left:0;right:0;border-radius: 20px;padding:10px">
        <h4 style="text-align: center;color:#042744;font-size: 22px;padding-top: 10px;font-weight: 900;"><b>Add PMU Product Scanner</b></h4>
        <hr>
        <button onclick="handleInstallClick()" style="color:#fff;background-color: #F67327;width:100%;height:60px;border:none;border-radius: 15px;font-size: 26px;">Add</button>
      </div>

    </div>

    <script>
      if('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/serviceWorker.js').then((reg) => {
            console.log('Worker Registered')
          }).catch((err) => {
            console.log('Error in service worker registration.')
          })
        })
      }
      var deferredPrompt;
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
      });
      var no = window.matchMedia('(display-mode: standalone)').matches

      if(no){
        document.getElementById('load').style.display="none";
        
      }

      var Name = "Unknown OS";
      if (navigator.userAgent.indexOf("Win") != -1) Name = "win";
      if (navigator.userAgent.indexOf("Mac") != -1) Name = "mac";
      if (navigator.userAgent.indexOf("Linux") != -1) Name = "linux";
      if (navigator.userAgent.indexOf("Android") != -1) Name = "android";
      if (navigator.userAgent.indexOf("like Mac") != -1) Name = "ios";

      if(Name=="ios"){
        document.getElementById('ios').style.display="block";
      }else if(Name=="android"){
        document.getElementById('android').style.display="block";
      }else{
        alert("Try in Android or iOS")
      }

	
      const handleInstallClick = (e) => {
        // Show the install prompt
        deferredPrompt.prompt();
        // Wait for the user to respond to the prompt
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
          } else {
            console.log('User dismissed the install prompt');
          }
        });
      };

    </script>
  <script>
      var resultContainer = document.getElementById('qr-reader-results');
      var lastResult, countResults = 0;

      async function onScanSuccess(decodedText, decodedResult) {
          if (decodedText !== lastResult) {
            ++countResults;
            lastResult = decodedText;
            fetch("/api?id="+decodedText)
            .then(res=>{
              if(res.status==200){
                document.getElementById('result').innerHTML=`<span style='color:green'>Product Verified Successfully!</span><br><br>
                  	<img style='display:block !important;width:150px;height:150px;margin:auto' src='/img/happy.jpeg'><br>
                      `;
                document.getElementById('alert').style.display='block';
                document.getElementById('qr-reader').style.opacity='0.2';
              }else{
                document.getElementById('result').innerHTML=`
					<span style='color:red'>Fake Product!</span><br><br>
                  	<img style='display:block !important;width:150px;height:150px;margin:auto' src='/img/sad.jpeg'>
                      <br>
      				<button onclick="complain()" style="height:50px;width:80%;background:red !important;color:#fff;font-size:20px;border:none;border-radius:10px">Complain</button>

				`;
                document.getElementById('alert').style.display='block';
                document.getElementById('qr-reader').style.opacity='0.2';
              }
            })
              
              
          }
      }
    async function complain(){
      navigator.geolocation.getCurrentPosition(showPosition)
      document.getElementById('alert').style.display='none';
      document.getElementById('qr-reader').style.opacity='1.0';
    }
    async function showPosition(position) {
      fetch("/api/com?data=lat"+position.coords.latitude+"long"+position.coords.longitude)
      .then((res)=>console.log(res.status))
    }

      var html5QrcodeScanner = new Html5QrcodeScanner("qr-reader", { fps: 10, qrbox: 250 });
      html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>